"use strict";require("core-js/modules/es.symbol.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.symbol.iterator.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.PseudoEventTarget=void 0,require("core-js/modules/es.array.reduce.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/es.object.assign.js"),require("core-js/modules/es.array.splice.js");var _PseudoEvent=require("./PseudoEvent"),_PseudoEventListener=require("./PseudoEventListener");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}var PseudoEventTarget=function(){function e(){_classCallCheck(this,e),this.listeners=[],this.defaultEvent=[]}return _createClass(e,[{key:"runEvents",value:function(e){if(!(e.type in this.listeners))return!0;var t=this.listeners[e.type],s=null;return this.listeners[e.type]=t.reduce((function(t,n){return e.immediatePropagationStopped||n.rejectEvent(e)?t.concat(n):(s=n.handleEvent(e),n.eventOptions.once?(e.currentTarget.removeEventListener(e.eventType,e.handleEvent),t):t.concat(n))}),[]),s}},{key:"setDefaultEvent",value:function(e,t){var s=this;e in this.listeners||(this[e]=function(){return s.startEvents(e)},this.listeners[e]=[]),this.defaultEvent[e]=t}},{key:"runDefaultEvent",value:function(e){if(e.defaultPrevented)return!1;this.defaultEvent[e.type](e)}},{key:"startEvents",value:function(e){var t=this,s=new _PseudoEvent.PseudoEvent(e);return s.setReadOnlyProperties({target:this}),console.log("startEvents",s.type,s.target),[_PseudoEvent.PseudoEvent.CAPTURING_PHASE,_PseudoEvent.PseudoEvent.AT_TARGET,_PseudoEvent.PseudoEvent.BUBBLING_PHASE].forEach((function(n){var r=null;n!==_PseudoEvent.PseudoEvent.AT_TARGET&&s.propagationStopped||(s.setReadOnlyProperties({eventPhase:n}),s.composedPath().forEach((function(e){s.setReadOnlyProperties({currentTarget:e}),r=s.currentTarget.runEvents(s)}))),s.eventPhase===_PseudoEvent.PseudoEvent.AT_TARGET&&"boolean"!=typeof r&&t.defaultEvent[e]&&t.runDefaultEvent(s)})),!0}},{key:"addEventListener",value:function(e,t){var s=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={capture:!1,once:!1,passive:!1};"object"===_typeof(n)?r=Object.keys(n).reduce((function(e,t){return e[t]=n[t],e}),r):r.capture=n,e in this.listeners||(this[e]=function(){return s.startEvents(e)},this.listeners[e]=[]),this.listeners[e]=this.listeners[e].concat([Object.assign(Object.create(_PseudoEventListener.PseudoEventListener),_PseudoEventListener.PseudoEventListener,{eventType:e,eventOptions:Object.assign({},_PseudoEventListener.PseudoEventListener.eventOptions,r),handleEvent:(t.handleEvent||t).bind(this)})]);var o=this.listeners[e].reduce((function(e,t){return t.isDefault?Object.assign({},e,{default:e.default.concat([t])}):Object.assign({},e,{explicit:e.explicit.concat([t])})}),{explicit:[],default:[]});this.listeners[e]=[].concat(o.explicit,o.default)}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var s=this.listeners[e],n=0,r=s.length;n<r;n++)if(s[n].handleEvent===t&&!s[n].isDefault)return void s.splice(n,1)}},{key:"dispatchEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return e.setReadOnlyProperties({target:t}),!(e.type in this.listeners)||(this.runEvents(e),!e.defaultPrevented)}}]),e}();exports.PseudoEventTarget=PseudoEventTarget;