"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var PseudoEvent=require("./PseudoEvent"),PseudoEventListener=require("./PseudoEventListener"),PseudoEventTarget=function(){function e(){_classCallCheck(this,e),this.listeners=[],this.defaultEvent=[]}return _createClass(e,[{key:"runEvents",value:function(e){if(!(e.type in this.listeners))return!0;var t=this.listeners[e.type],n=null;return this.listeners[e.type]=t.reduce((function(t,r){return e.immediatePropagationStopped||r.rejectEvent(e)?t.concat(r):(n=r.handleEvent(e),r.eventOptions.once?(e.currentTarget.removeEventListener(e.eventType,e.handleEvent),t):t.concat(r))}),[]),n}},{key:"setDefaultEvent",value:function(e,t){var n=this;e in this.listeners||(this[e]=function(){return n.startEvents(e)},this.listeners[e]=[]),this.defaultEvent[e]=t}},{key:"runDefaultEvent",value:function(e){if(e.defaultPrevented)return!1;this.defaultEvent[e.type](e)}},{key:"startEvents",value:function(e){var t=this,n=new PseudoEvent(e);return n.setReadOnlyProperties({target:this}),console.log("startEvents",n.type,n.target),[PseudoEvent.CAPTURING_PHASE,PseudoEvent.AT_TARGET,PseudoEvent.BUBBLING_PHASE].forEach((function(r){var s=null;r!==PseudoEvent.AT_TARGET&&n.propagationStopped||(n.setReadOnlyProperties({eventPhase:r}),n.composedPath().forEach((function(e){n.setReadOnlyProperties({currentTarget:e}),s=n.currentTarget.runEvents(n)}))),n.eventPhase===PseudoEvent.AT_TARGET&&"boolean"!=typeof s&&t.defaultEvent[e]&&t.runDefaultEvent(n)})),!0}},{key:"addEventListener",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s={capture:!1,once:!1,passive:!1};"object"===_typeof(r)?s=Object.keys(r).reduce((function(e,t){return e[t]=r[t],e}),s):s.capture=r,e in this.listeners||(this[e]=function(){return n.startEvents(e)},this.listeners[e]=[]),this.listeners[e]=this.listeners[e].concat([Object.assign(Object.create(PseudoEventListener),PseudoEventListener,{eventType:e,eventOptions:Object.assign({},PseudoEventListener.eventOptions,s),handleEvent:(t.handleEvent||t).bind(this)})]);var i=this.listeners[e].reduce((function(e,t){return t.isDefault?Object.assign({},e,{default:e.default.concat([t])}):Object.assign({},e,{explicit:e.explicit.concat([t])})}),{explicit:[],default:[]});this.listeners[e]=[].concat(i.explicit,i.default)}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=this.listeners[e],r=0,s=n.length;r<s;r++)if(n[r].handleEvent===t&&!n[r].isDefault)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return e.setReadOnlyProperties({target:t}),!(e.type in this.listeners)||(this.runEvents(e),!e.defaultPrevented)}}]),e}();module.exports=PseudoEventTarget;